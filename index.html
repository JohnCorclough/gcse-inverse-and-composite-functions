<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Inverse & Composite Functions Quiz</title>

<style>
  :root {
    --bg: #f2f2f2;
    --card: #ffffff;
    --shadow: rgba(0,0,0,0.15);
    --btn: #e9e9e9;
    --btnHover: #e2e2e2;
    --btnActive: #dcdcdc;

    --okBg: #d8f5d8;
    --badBg: #ffd9d9;

    --outline: rgba(0,0,0,0.35);
  }

  body{
    font-family: Arial, sans-serif;
    background: var(--bg);
    margin: 0;
    padding: 0;
    display:flex;
    justify-content:center;
  }

  .card{
    background: var(--card);
    margin: 10px;
    padding: 18px;
    border-radius: 12px;
    width: 95%;
    max-width: 780px;
    box-shadow: 0 4px 12px var(--shadow);
  }

  h2{
    margin: 0 0 10px 0;
    font-size: 20px;
  }

  #question{
    font-size: 16px;
    line-height: 1.35;
    margin: 12px 0;
  }

  .answers button{
    display:block;
    width:100%;
    margin: 10px 0;
    padding: 14px;
    font-size: 16px;
    border-radius: 10px;
    border: none;
    background: var(--btn);
    cursor:pointer;
    transition: filter 0.08s ease;
  }

  .answers button:hover{
    background: var(--btnHover);
  }

  .answers button:active{
    background: var(--btnActive);
  }

  /* Show the student's chosen answer without disabling buttons */
  .answers button.selected{
    outline: 3px solid var(--outline);
    outline-offset: 2px;
  }

  .explain{
    margin-top: 12px;
    padding: 12px;
    border-radius: 10px;
    min-height: 44px;
    display: none;
  }

  .explain.ok{ background: var(--okBg); display:block; }
  .explain.bad{ background: var(--badBg); display:block; }

  .controls{
    margin-top: 12px;
  }

  .controls button{
    width: 100%;
    padding: 14px;
    border-radius: 10px;
    border: none;
    background: #dfe9ff;
    cursor: pointer;
    font-size: 16px;
  }

  .controls button:active{
    filter: brightness(0.96);
  }

  .meta{
    margin-top: 10px;
    font-size: 14px;
  }

  .small{ opacity: 0.85; }

  @media (min-width: 600px){
    h2{ font-size: 22px; }
    .answers button{ font-size: 15px; padding: 12px; }
    .controls button{ font-size: 15px; padding: 12px; }
  }
</style>
</head>

<body>
  <div class="card">
    <h2>Inverse & Composite Functions</h2>

    <div id="question"></div>
    <div class="answers" id="answers"></div>

    <div class="explain" id="explainBox"></div>

    <div class="controls">
      <button id="nextBtn" onclick="nextQuestion()">Next Question</button>
    </div>

    <div class="meta" id="progress"></div>
    <div class="meta" id="score"></div>
    <div class="meta small" id="mode"></div>
  </div>

<script>
const originalQuiz = [
  {
    topic: "Inverse Functions",
    q: "f(x) = 3x + 5. What is f⁻¹(x)?",
    options: ["(x − 5) / 3", "3x − 5", "(x + 5) / 3", "1 / (3x + 5)"],
    answer: 0,
    explainCorrect:
      "Let y = 3x + 5. Swap x and y: x = 3y + 5. Rearrange: x − 5 = 3y, so y = (x − 5)/3.",
    explainWrong:
      "Inverse means undo the function. Swap x and y, then rearrange for y. That gives (x − 5)/3."
  },
  {
    topic: "Inverse Functions",
    q: "f(x) = 2x − 7. Find f⁻¹(5).",
    options: ["6", "−1", "4", "12"],
    answer: 0,
    explainCorrect:
      "Find f⁻¹(x): y = 2x − 7 → swap: x = 2y − 7 → y = (x + 7)/2. Then f⁻¹(5) = (5 + 7)/2 = 6.",
    explainWrong:
      "Find the inverse rule first: f⁻¹(x) = (x + 7)/2. Then substitute x = 5 to get 6."
  },
  {
    topic: "Inverse Functions",
    q: "f(x) = x + 4. Which statement is true?",
    options: ["f⁻¹(x) = x − 4", "f⁻¹(x) = x + 4", "f⁻¹(x) = 1/(x+4)", "No inverse exists"],
    answer: 0,
    explainCorrect:
      "f(x) adds 4, so the inverse must subtract 4 to undo it: f⁻¹(x) = x − 4.",
    explainWrong:
      "An inverse undoes the function. Since f(x)=x+4 adds 4, the inverse must be x−4."
  },
  {
    topic: "Composite Functions",
    q: "f(x) = x², g(x) = x + 3. Find f(g(x)).",
    options: ["(x + 3)²", "x² + 3", "x² + 9", "2x + 3"],
    answer: 0,
    explainCorrect:
      "f(g(x)) means substitute g(x) into f. Since f(x)=x², replace x with (x+3): (x+3)².",
    explainWrong:
      "You must square the entire g(x), not just x. The correct substitution gives (x+3)²."
  },
  {
    topic: "Composite Functions",
    q: "f(x) = 2x, g(x) = x − 4. Find f(g(x)).",
    options: ["2x − 4", "2x − 8", "x − 8", "2x + 8"],
    answer: 1,
    explainCorrect:
      "Substitute g(x) into f: f(g(x)) = 2(g(x)) = 2(x−4) = 2x − 8.",
    explainWrong:
      "You must multiply the whole bracket: f(g(x)) = 2(x−4) = 2x−8 (not 2x−4)."
  },
  {
    topic: "Composite Functions",
    q: "f(x) = x + 1, g(x) = 3x. Find f(g(x)).",
    options: ["3x + 1", "3x + 3", "x + 4", "3(x + 1)"],
    answer: 0,
    explainCorrect:
      "Replace x in f(x)=x+1 with g(x)=3x: f(g(x)) = 3x + 1.",
    explainWrong:
      "Substitute g(x) into f(x)=x+1: it becomes 3x + 1."
  },
  {
    topic: "Composite Functions",
    q: "f(x) = x² + 2, g(x) = x − 1. Find f(g(x)).",
    options: ["(x − 1)² + 2", "x² + 1", "x² − 1 + 2", "(x²+2)−1"],
    answer: 0,
    explainCorrect:
      "Replace x with (x−1): f(g(x)) = (x−1)² + 2. The square applies to the whole bracket.",
    explainWrong:
      "Because f includes x², you must square (x−1): (x−1)² + 2."
  },
  {
    topic: "Composite Functions",
    q: "f(x) = 5 − x, g(x) = 2x. Find f(g(x)).",
    options: ["5 − 2x", "10 − x", "2x − 5", "5x − 2"],
    answer: 0,
    explainCorrect:
      "Substitute g(x)=2x into 5−x: f(g(x)) = 5 − (2x) = 5 − 2x.",
    explainWrong:
      "Replace x with 2x: 5 − (2x) = 5 − 2x."
  }
];

function shuffle(arr){
  for(let i = arr.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

let quiz = shuffle([...originalQuiz]);
let incorrectQuestions = [];
let current = 0;
let score = 0;

let answeredThisQuestion = false;
let inRetryRound = false;

const questionEl = document.getElementById("question");
const answersEl = document.getElementById("answers");
const explainBox = document.getElementById("explainBox");
const progressEl = document.getElementById("progress");
const scoreEl = document.getElementById("score");
const modeEl = document.getElementById("mode");
const nextBtn = document.getElementById("nextBtn");

function clearSelected(){
  const btns = answersEl.querySelectorAll("button");
  btns.forEach(b => b.classList.remove("selected"));
}

function renderMode(){
  modeEl.textContent = inRetryRound ? "Mode: Retry incorrect questions" : "Mode: Main quiz (random order)";
}

function showExplain(type, html){
  explainBox.className = "explain " + type;
  explainBox.innerHTML = html;
  explainBox.style.display = "block";
}

function hideExplain(){
  explainBox.className = "explain";
  explainBox.style.display = "none";
  explainBox.innerHTML = "";
}

function loadQuestion(){
  if(current >= quiz.length){
    if(incorrectQuestions.length > 0){
      quiz = shuffle([...incorrectQuestions]);
      incorrectQuestions = [];
      current = 0;
      inRetryRound = true;
      renderMode();

      questionEl.innerHTML = "<strong>Retry time!</strong><br><br>Now you’ll redo only the questions you got wrong.";
      answersEl.innerHTML = "";
      hideExplain();
      progressEl.textContent = "";
      scoreEl.textContent = "Score: " + score;
      nextBtn.textContent = "Start Retry";
      answeredThisQuestion = true; // allow Next
      return;
    }

    questionEl.innerHTML = "<strong>Quiz complete.</strong><br><br>You have finished all questions (including retries).";
    answersEl.innerHTML = "";
    hideExplain();
    progressEl.textContent = "";
    scoreEl.textContent = "Final Score: " + score + " / " + originalQuiz.length;
    modeEl.textContent = "";
    nextBtn.textContent = "Restart";
    answeredThisQuestion = true;
    return;
  }

  const item = quiz[current];
  answeredThisQuestion = false;
  nextBtn.textContent = "Next Question";

  questionEl.innerHTML = "<strong>" + item.topic + "</strong><br><br>" + item.q;

  answersEl.innerHTML = "";
  item.options.forEach((opt, i) => {
    const btn = document.createElement("button");
    btn.textContent = opt;
    btn.onclick = () => checkAnswer(i, btn);
    answersEl.appendChild(btn);
  });

  hideExplain();
  progressEl.textContent = "Question " + (current + 1) + " of " + quiz.length;
  scoreEl.textContent = "Score: " + score;
  renderMode();
}

function checkAnswer(choice, clickedBtn){
  if(answeredThisQuestion) return;

  const item = quiz[current];
  answeredThisQuestion = true;

  clearSelected();
  clickedBtn.classList.add("selected");

  if(choice === item.answer){
    score++;
    showExplain("ok", "✅ <strong>Correct.</strong><br><br>" + item.explainCorrect);
  } else {
    incorrectQuestions.push(item);
    const correctText = item.options[item.answer];
    showExplain(
      "bad",
      "❌ <strong>Incorrect.</strong><br><br>" +
      item.explainWrong +
      "<br><br><strong>Correct answer:</strong> " + correctText
    );
  }

  scoreEl.textContent = "Score: " + score;
}

function nextQuestion(){
  if(nextBtn.textContent === "Restart"){
    quiz = shuffle([...originalQuiz]);
    incorrectQuestions = [];
    current = 0;
    score = 0;
    inRetryRound = false;
    loadQuestion();
    return;
  }

  if(!answeredThisQuestion){
    showExplain("bad", "Please choose an answer before moving on.");
    return;
  }

  current++;
  loadQuestion();
}

loadQuestion();
</script>
</body>
</html>
